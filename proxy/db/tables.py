# ------------------ Table definitions ---------------------
WRITE_USER_TABLE = """CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(100) NOT NULL,
    password VARCHAR(250) NOT NULL
);"""

WRITE_FILE_TABLE = """
CREATE TABLE IF NOT EXISTS files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER DEFAULT NULL,
    file_name VARCHAR(120),
    file_url VARCHAR(120)
);
"""

WRITE_TABLE_LOGS = """CREATE TABLE IF NOT EXISTS logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER DEFAULT NULL,
    state BOOLEAN,
    date DATE
);"""


# ------------------- quries -------------------------

PER_USER_COUNT = """SELECT u.username, COUNT(l.id) AS record_count
FROM users u
LEFT JOIN logs l ON u.id = l.user_id
GROUP BY u.id, u.username;"""

PER_FILE_TYPE_COUNT = """
SELECT
    date,
    COUNT(*) AS total_states,
    SUM(CASE WHEN state = TRUE THEN 1 ELSE 0 END) AS virus_files,
    SUM(CASE WHEN state = FALSE THEN 1 ELSE 0 END) AS benign_files
FROM logs
GROUP BY date;
"""

GET_ALL_FILES ="""
    SELECT files.file_name, files.file_url, users.id, users.username
    FROM files
    INNER JOIN users
    ON files.user_id = users.id;
"""

GET_ALL_USERS = """
    SELECT id, username FROM users
"""